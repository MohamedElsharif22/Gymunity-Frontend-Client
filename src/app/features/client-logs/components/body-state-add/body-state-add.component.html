<div class="container mx-auto px-4 py-8 max-w-2xl">
  <h1 class="text-3xl font-bold mb-8">Add Body State Log</h1>

  @if (error()) {
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
      {{ error() }}
    </div>
  }

  @if (success()) {
    <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
      Body state log added successfully! Redirecting...
    </div>
  }

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-6">
    <!-- Weight (Required) -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">
        Weight (kg) <span class="text-red-500">*</span>
      </label>
      <input
        type="number"
        formControlName="weightKg"
        step="0.1"
        min="20"
        max="500"
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        placeholder="Enter weight in kg"
      />
      @if (form.get('weightKg')?.invalid && form.get('weightKg')?.touched) {
        <p class="text-red-500 text-sm mt-1">Weight must be between 20-500 kg</p>
      }
    </div>

    <!-- Body Fat Percentage -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">
        Body Fat Percentage (%)
      </label>
      <input
        type="number"
        formControlName="bodyFatPercent"
        step="0.1"
        min="1"
        max="80"
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        placeholder="Enter body fat percentage"
      />
      @if (form.get('bodyFatPercent')?.invalid && form.get('bodyFatPercent')?.touched) {
        <p class="text-red-500 text-sm mt-1">Body fat must be between 1-80%</p>
      }
    </div>

    <!-- Measurements JSON -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">
        Measurements (JSON)
      </label>
      <textarea
        formControlName="measurementsJson"
        rows="3"
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm"
        placeholder='e.g., {"waist": 82, "chest": 95}'
      ></textarea>
      @if (measurementsError()) {
        <p class="text-red-500 text-sm mt-1">{{ measurementsError() }}</p>
      }
    </div>

    <!-- Photos -->
    <div class="space-y-4">
      <label class="block text-sm font-medium text-gray-700">Photos</label>
      
      <div>
        <label class="block text-xs font-medium text-gray-600 mb-1">Front Photo URL</label>
        <input
          type="url"
          formControlName="photoFrontUrl"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          placeholder="https://..."
        />
      </div>

      <div>
        <label class="block text-xs font-medium text-gray-600 mb-1">Side Photo URL</label>
        <input
          type="url"
          formControlName="photoSideUrl"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          placeholder="https://..."
        />
      </div>

      <div>
        <label class="block text-xs font-medium text-gray-600 mb-1">Back Photo URL</label>
        <input
          type="url"
          formControlName="photoBackUrl"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          placeholder="https://..."
        />
      </div>
    </div>

    <!-- Notes -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">
        Notes
      </label>
      <textarea
        formControlName="notes"
        rows="3"
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        placeholder="Any additional notes..."
      ></textarea>
    </div>

    <!-- Buttons -->
    <div class="flex gap-4 pt-6">
      <button
        type="submit"
        [disabled]="loading()"
        class="flex-1 bg-blue-600 text-white font-medium py-2 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition"
      >
        {{ loading() ? 'Saving...' : 'Save Log' }}
      </button>
      <button
        type="button"
        routerLink="/client/body-state"
        class="flex-1 bg-gray-300 text-gray-700 font-medium py-2 rounded-lg hover:bg-gray-400 transition"
      >
        Cancel
      </button>
    </div>
  </form>
</div>

@if (!form) {
  <p>Loading form...</p>
}
