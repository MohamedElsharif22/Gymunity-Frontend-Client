<div class="flex h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 flex-col md:flex-row overflow-hidden">
  <!-- Chat Container -->
  <div class="flex w-full gap-2 md:gap-4 p-2 md:p-4 flex-col md:flex-row h-full overflow-hidden">
    <!-- Chat List Section - Hidden on mobile when viewing chat, shown on desktop -->
    <div [class.hidden]="showChatWindow() && !isDesktop()" class="w-full md:w-96 md:shrink-0 flex-shrink-0 overflow-hidden transition-all duration-200">
      <app-chat-list
        [threads]="threads()"
        [selectedThread]="currentThread()"
        [isConnecting]="isConnecting()"
        [isLoading]="isLoading()"
        [unreadCount]="unreadCount()"
        (selectThread)="onSelectThread($event)"
        (startNewChat)="onStartNewChat($event)"
        (refresh)="onRefresh()"
      />
    </div>

    <!-- Chat Window Section - Hidden on mobile unless thread selected, always shown on desktop -->
    <div [class.hidden]="!showChatWindow() && !isDesktop()" class="flex-1 min-w-0 flex flex-col overflow-hidden transition-all duration-200">
      @if (isConnected()) {
        @if (currentThread()) {
          <!-- Back Button for Mobile -->
          <div class="md:hidden bg-white border-b border-gray-200 p-2">
            <button
              (click)="onBackToList()"
              class="flex items-center gap-2 text-blue-600 hover:text-blue-700 font-medium text-sm transition-colors"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
              </svg>
              Back to Chats
            </button>
          </div>

          <app-chat-window
            [messages]="messages()"
            [currentUser]="currentUser()"
            [selectedThread]="currentThread()"
            [messageChangeTrigger]="getMessagesChangeTrigger()"
            (sendMessage)="onSendMessage($event)"
          />
        } @else {
          <!-- Empty State with Enhanced Design -->
          <div class="h-full flex flex-col items-center justify-center bg-white rounded-2xl shadow-2xl border border-blue-100 overflow-hidden relative">
            <!-- Decorative Background -->
            <div class="absolute inset-0 bg-gradient-to-br from-blue-50/50 via-transparent to-indigo-50/50 pointer-events-none"></div>
            
            <!-- Content -->
            <div class="relative z-10 flex flex-col items-center justify-center h-full">
              <div class="mb-6 p-6 rounded-full bg-gradient-to-br from-blue-100 to-indigo-100 shadow-lg">
                <svg
                  class="w-16 h-16 md:w-20 md:h-20 text-blue-500"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="1.5"
                    d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
                  />
                </svg>
              </div>
              <h3 class="text-xl md:text-2xl font-bold text-gray-800 mb-2 text-center px-4">Select a Conversation</h3>
              <p class="text-gray-500 text-sm md:text-base text-center px-4 max-w-sm">Choose a thread from the list to start chatting with your trainer</p>
              
              <!-- Animated Arrow Down -->
              <div class="mt-8 animate-bounce md:hidden">
                <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>
                </svg>
              </div>
            </div>
          </div>
        }
      } @else {
        <!-- Loading State with Enhanced Design -->
        <div class="h-full flex flex-col items-center justify-center bg-white rounded-2xl shadow-2xl border border-blue-100 overflow-hidden relative">
          <!-- Decorative Background -->
          <div class="absolute inset-0 bg-gradient-to-br from-blue-50/50 via-transparent to-indigo-50/50 pointer-events-none"></div>
          
          <!-- Loading Content -->
          <div class="relative z-10 flex flex-col items-center justify-center">
            <div class="relative w-16 h-16 md:w-20 md:h-20 mb-6">
              <!-- Spinning Background Circle -->
              <svg class="absolute inset-0 w-full h-full text-blue-200 opacity-30 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
              </svg>
              <!-- Icon -->
              <div class="absolute inset-0 flex items-center justify-center">
                <svg class="w-8 h-8 md:w-10 md:h-10 text-blue-600 animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"
                  />
                </svg>
              </div>
            </div>
            <h3 class="text-lg md:text-xl font-semibold text-gray-700 mb-2 text-center">Connecting to Chat</h3>
            <p class="text-gray-500 text-sm text-center px-4 max-w-sm">Establishing connection with the server...</p>
            
            <!-- Loading Dots -->
            <div class="mt-6 flex gap-1">
              <div class="w-2 h-2 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 0s"></div>
              <div class="w-2 h-2 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
              <div class="w-2 h-2 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
            </div>
          </div>
        </div>
      }
    </div>
  </div>
</div>
